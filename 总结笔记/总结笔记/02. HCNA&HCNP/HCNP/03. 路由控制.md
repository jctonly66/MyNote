## 一、路由选择工具

1. 访问控制列表（ACL）：用于匹配路由信息或者数据包的地址，过滤不符合条件的路由信息或数据包。
2. 前缀列表（ip-prefix）：匹配对象为路由信息的目的地址或直接作用于路由器对象（gateway）。
3. 路由策略（route-policy）：设定匹配规则，由if-match和apply子句组成。

路由选择工具可以过滤RIP等传递路由表的协议，但是无法过滤OSPF（因为它传递的是LAS）

### 1. 访问控制列表

访问控制列表也可以用来进行路由选择。

访问控制列表有两种匹配顺序：

1. 配置顺序：按照用户配置ACL规则的先后进行排序。
2. 自动排序：自动排序使用“深度优先”的原则，是把指定范围最小的语句排在最前面。

```
rip
 filter-policy 2000 export g0/0/0 
```

在华为设备上，如果用ACL做路由筛选，permit就可以，没有permit的自动过滤掉。

### 2. 前缀列表

前缀列表用来过滤IP前缀，能同时匹配前缀号和前缀长度。

前缀列表的性能比访问控制列表高；前缀列表不能用于数据包的过滤。

```
ip ip-prefix test index 10 permit/deny x.x.x.x 16(匹配长度) greater-equal 24（掩码1） less-equal 28（掩码2）
rip 
 filter-policy in-prefix r2-in import g0/0/0  # 链路状态协议不要写接口
```

### 3.  route-policy

一个routing policy下可以有多个节点，不同的节点号用seq-number标识，不同seq-number各个部分之间的关系是“或”的关系。

1. 每个节点下可以有多个if-match和apply子句，if-match子句之间是“与”的关系；
2. 允许模式：当路由项满足该节点的所有if-match子句时，将被允许通过该节点的过滤并执行该节点的apply子句，如路由项不满足该节点的if-match子句，将试图匹配路由策略的下一个节点；
3. 拒绝模式：当路由项满足该节点的所有if-match子句时，将被拒绝通过该节点的过滤，并且不会继续下一个节点的测试；
4. if-match子句可以引用其它的过滤工具。

```
route-policy policy_name1 permit node 10 
 if-match acl xxx
 if-match ip-prefix xxx  # acl prefix只能调用一次
```

## 二、路由引入

### 1. 为什么需要路由注入

1. 部署不同路由协议的机构合并
2. 不同的网络使用不同的协议，并且这些网络需要共享路由信息
   1. 简单的网络可以使用RIP
   2. 网络类型复杂的可以选用OSPF
   3. 大型骨干网络一般选用ISIS
3. 网络协议的限制
   1. 比如，使用拨号链路连接两个ISIS网络，而在拨号链路上是不适合运行ISIS协议的
   2. 需要配置静态路由，然后把静态路由引入到ISIS

### 2. 路由引入命令

```
import-route director
import-route static 
```

路由引入时要注意开销的变化。引入时可以加入cost设置。

路由引入可能导致环路，所以导入时一定要小心。

## 三、基于策略的路由转发

策略路由和路由策略都可以影响数据包的转发过程，但他们对数据包的的影响方式是不一样的。

### 3.1 策略路由

策略路由是一种依据用户制定的策略进行报文转发路径选择的机制，与单纯依照IP报文的目的地址查找路由表进行转发不同，可应用于安全、Qos、负载分担等目的。

策略路由支持基于ACL、报文长度等信息，来灵活地指定数据包的转发路径。

#### 3.1.1 策略路由作用

1. 为网络管理员提供了比传统路由协议对报文的转发和存储更强的控制能力
   1. 使网络管理员不仅能够根据目的地址，而且能够根据协议类型、报文大小、应用、IP源地址或者其他的策略来选择转发路径。
   2. 可以控制多个路由器之间的负载分担、单一链路上报文转发的Qos或者满足某种特定限定。

### 3.2策略路由和路由策略的区别

1. 策略路由可以不按照路由表进行报文的转发
2. 路由策略主要控制路由信息的引入、发布、接收等