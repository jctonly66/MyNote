## 基础知识

PHP（ Hypertext Preprocessor，中文名：“超文本预处理器”）是一种通用开源脚本语言，主要用来实现动态网站。

Web服务器默认的端口号是80，Mysql服务器默认的端口是3306，FTP默认的端口是21。

PHP中分前台、后台、客户端、服务器端：

- 前台：浏览者看到的页面，用来显示数据；后台：管理员看的页面，用来操作数据。
- 客服端：前台/后台，用来显示网页；服务器端：存储网页。

### ZendOptimizer安装

ZendOptimizer软件能使PHP运行效果极大的提高。

### 解释还是编译

PHP会在执行时缓存opcode文件到内存中，所以PHP执行效率非常高。

从概念来理解，PHP没有保存中间代码，可以说PHP是解释型语言。但是PHP的执行过程将opcode缓存包存在内存中，从这个角度来说PHP是编译型的。

## PHP语法

###PHP四种定界符

1. 标准风格，推荐使用

   ```
   <?php  //PHP代码  ?>
   ```

2. 短标记风格，默认情况不支持，必须在PHP配置文件中更改配置，把short_open_tag修改为On

   ```
   <?   ?>
   ```

3. asp风格，默认情况下不支持asp风格，需要在配置文件中更改asp_tags为On

   ```
   <%  %>
   ```

4. script风格 

   ```
   <script language='php'> </script>
   ```

PHP支持省略结束定界符。

---

### 输出语句

1. `echo`：输出基本类型的数据，可以输出多个值，每个值用逗号隔开。
2. `print`：只能输出一个值，输出规则和echo一样。输出成功返回1，输出失败返回0。
3. `print_r()`：可以输出数组
4. `var_dump()`：输出数据类型、数据长度、数组的元素、对象。

---

### 基本数据类型

#### 浮点型数据

**浮点数不能做比较，如果需要比较，通过bccomp()函数去比较。**

由于浮点数转成二进制是乘2正向去整，可能会一直循环下去。所有浮点数保存的值是近似值。 

#### 字符串

##### 双引号跟单引号字符串

在PHP中，如果字符串内有变量，双引号会输出变量的值，单引号不会。双引号要做运算，所以相对单引号，它的执行效率会变低。一半在输出语句中输出变量时使用{}

```
$name = 'aee';
echo '我的名字是$name';  // 我的名字是$name
echo "我的名字是$name";  // 我的名字是aee
echo '$name是我的名字';  // $name是我的名字
echo "$name是我的名字";  // 报错，没有这个变量
echo "{$name}是我的名字" // aee是我的名字，{$只要挨在一起就作用，比图${
```

##### 字符串定界符

为输出大量的文本提供了简单方法。开始和结束的定界符必须一样。开始标识符前面有三个`<<<`号。结束标志符必须顶格写。前面不能有空格和其他字符。标识符的后面也不能有空格。

```
echo <<<str
    // H5代码
str;
```

字符定界符分为heredoc和nowdoc，heredoc相当于双引号字符串（不写代表双引号），nowdoc相当于单引号字符串。

##### ASCII码

1. 小写的字母比大写的大；
2. 小写字母和大写字母之间相差32   a-A=32；
3. `ord()`：将字符转成十进制ASCII码；
4. `chr()`：将十进制转换成字符；
5. `\`可以转义ASCII码。

#### 数组

数组分为索引数组跟关联数组

- 索引数组：就是普通的数组；
- 关联数组：`$emp=array('name'=>'李白','sex'=>'男');`数组的值和一个字符串做关联，形成一个键值对。

##### 数组的声明

1. `$arr = array('李白','杜甫','白居易');`

2. `$worker[] = 'bot'; $worker[] = 'afa'; `，0=>bot，1=>afa

3. `extract()`：将数组中的变量导入到当前的符号表，键名做变量名，键值做变量的值。

   ```
   $stu = arrat('id'=>1, 'name'=>'tom');
   extract($stu);
   echo $id, $name;
   ```

如果数组连续两次输出，必须将数组先复位。

数组复制的时候，如果指针合法，指针一起复制。如果指针不合法，先使用数组的指针会被重新初始化。

##### 写时复制

COW：copy on write，在值传递的情况下，数据在赋值时候，内部存在一个优化，叫写时复制。

在值传递的赋值时，真实的数据空间不是立即复制的，而是在其中一个变量执行写操作的时候才会重新分配内存空间。

#### 资源

PHP引用的外部数据称为资源；资源只能获取，不能创建；资源也是有类别的，比如连接资源、数据流。

#### NULL

NULL表示没有定义的变量；NULL不区分大小写；调用一个没有返回值的函数，函数默认返回NULL。

#### 数据类型转换

1. 一个是字符串，一个是数字时，会把字符串转换成数字型再比较。'abc' == 0返回true；

2. 使用`(int)`等函数可以进行强制类型转换。

3. 与bool型之间的转换规律：

   1. 字符串/数组转换规律：'0' 或 「空' '」为false；

      ```
      //字符串和bool的转换规律
      var_dump((bool)'abcd');		//true
      var_dump((bool)'');			//false
      var_dump((bool)'0');		//false
      var_dump((bool)'0.0');		//true
      var_dump((bool)'00');		//true
      var_dump((bool)'false');	//true
      var_dump((bool)'null');		//true
      //数组和bool的转换规律
      var_dump((bool)array());	//false
      var_dump((bool)array(1));	//true
      var_dump((bool)array(false));//true
      //数组和null的转换规律
      var_dump((bool)null);		//false
      ```

   2. 数字转换规律：0为false；

      ```
      //数字和bool的转换规律
      var_dump((bool)1);			//true
      var_dump((bool)0);			//false
      var_dump((bool)-10);		//true
      var_dump((bool)1.1);		//true
      var_dump((bool)0.0);		//false
      var_dump((bool)-1.1);		//true
      ```

---

###变量

PHP中变量名**不区分**大小写。变量必须以`$`开头，`$`不是变量名的一部分，仅仅表示变量名的开始。

`&$a`：表示取出变量a的地址。

`unset()`：销毁变量，PHP可以通过unset()销毁变量名，变量的值由PHP的垃圾回收机制去回收。

####变量的类型

##### 全局变量

全局变量表示在函数外部的变量。

全局变量在声明的时候产生，页面执行完毕后销毁；

##### 局部变量

局部变量表示在函数内部的变量。

局部变量：函数执行的时候产生，函数执行完毕后销毁。

##### 超全局变量

超全局变量在函数的内部和外部使用。

包括：`$_COOKIE`、`$_ENV`、`$_FILES`、`$_GET`、`$_POST`、`$_REQUEST`、`$_SERVER`、`$_SESSION`、`$GLOBALS`。

`$_REQUEST`：保存get和post的数据。如果出现同名，默认情况下，post的值会将get同名的值覆盖，可以在配置文件中修改此规则（request_order）。

超全局变量的数据类型都是数组。  超全局变量可以在函数内部及外部一起访问。

##### 与JS区别

在JS中，局部变量只能在函数内部使用，全局变量在函数内部和函数外部使用；但是在PHP中全局变量只能在函数外部使用。

PHP中在函数内外部使用变量有三种方法：

1. 通过超全局变量

   ```
   $_GET['num'] = 10;
   function fun() {
       echo $_GET['num'];
   }
   ```

2. 通过$GLOBALS[]获取全局变量的值，也可以创建一个全局变量。

   ```
   $num = 10;
   function fun() {
       $num2 = 20;
       echo $GLOBALS['num'];
   }
   ```

3. 使用global关键字创建一个对全局变量的引用，也可以创建一个全局变量。

   ```
   $num1 = 10;
   function fun() {
       global $num1;
       echo $num1;
   }
   ```

####变量的其他分类

#####可变变量

将变量名存储到另一个变量中，保存函数名，主要用来简化操作，函数名可以拼写出来再使用。

```
$a = 'ffff';
$b = a;
echo $$b;   // ffff 
```

##### 静态变量

静态变量放在函数内部。它的作用域不变，还是在函数内部访问，但是生命周期变了，页面执行完毕后才销毁。就是可以在一个函数重复调用时保存上次的值。它只能被初始化一次。 但是仅限于该函数，如果另外一个函数重新定义，属于另外一个函数。

```
static $num1;
```

### 常量

当一个数据在脚本执行的周期内不发生变化，可以将这个数据保存在常量中。常量前面没有$。

define(常量名, 常量值, 是否区分大小写);	// 默认是区分大小写

定义常量可以使用特殊字符，但是使用时需要添加constant关键字调用。常量是固定不变的。

还可以用constant来声明常量。`constant NATION='中国';`

显示所有常量：`var_dump(get_defined_constants(true));  // true：表示将所有的常量分类显示`	

### 函数

#### 函数定义

```
function 函数名(参数,参数,...) { //函数体 }    // 函数名不区分大小写
```

函数名可以存放在变量中，然后直接调用这个变量进行函数使用。

#####使用`create_function()`创建函数

```
$fn = create_function('$name', 'echo \'你好\'.$name;'); // 通过此函数，只需要定义需要的函数即可
fn('libai'); 
```

创建完函数后，可以使用`function_exists('fun')`来判断函数是否存在。

#####地址传址

地址传址需要在**定义函数**时参数上加上&。在调用函数的时候只能传变量，不能传递具体的值。

#### 函数参数

#####默认参数

可以给参数设置一个默认参数，`function fun($arr = hahah) {};`；

默认值必须是一个存在的值，不能通过变量来代替，但是可以是常量，有默认值的参数要放在后面。

#####参数个数错误

实参少于形参数的时候，报一个错误，继续执行。

实参多于形参时，正常执行，取前面对应的值。

#####获取参数信息

`func_num_args();`    获取参数的个数

`func_get_args(); `   获取传递的所有参数并转成数组

#### 函数的返回值

定义函数时，在函数名前面加上&符号，表示返回函数的引用；调用函数时，在函数名前加上&符。如果没有&符，保存的是返回值的地址。

#### 函数递归调用

在递归调用的时候，有时候可能PHP执行的时间不够用，可以通过PHP.ini配置文件更改PHP最大执行时间。

```
max_execution_time = 30
```

#### 函数的代理调用

不直接通过函数名去调用函数，而是通过PHP的内置函数`call_user_func_array()`来调用函数。

#### 匿名函数

##### 使用use()

匿名函数的作用域和普通函数是一样的，函数内部不能访问函数外部的变量，匿名函数中的use()可以将匿名函数外的变量引入到匿名函数内部。

user()引入和匿名函数同作用域的函数。

```
$num = 10;
$fun = function() use ($num) {
    echo $num;
};
fun();
```

默认情况下，user()是用来传值的。

#### 函数预加载

代码的执行过程：

词法分析——语法分析——编译——加载编译的代码——执行，在执行代码之前，函数已经加载到内存中了。

#### 函数中的魔法常量

1. `__FUNCTION__`：获取当前函数名。

### 注释

1. HTML注释：<!-- HTML 注释 -->
2. CSS注释：/* CSS注释 */
3. Javascript注释：   //  或者  /*  */
4. PHP注释： //  #  /* */
5. MySQL注释：--  /* */

### PHP代码执行过程

客户端想服务器端发送请求，服务器会解析PHP代码生成一个标准的HTML，将HTML代码发送到客户端，浏览器解析HTML代码，生成我们看到的界面。就是在HTML中加入PHP执行输出的值。

### Foreach

1. 语法一：

   ```
   foreach(数组 as 值){}
   ```

2. 语法二：

   ```
   foreach(数组 as 键=>值) {}
   ```

#### foreach数组指针

指针其实也是一个变量，用来保存某个元素的地址。指针可以移动。

默认情况下，打开一个数组，指针会指向数组的第一个元素。

#### 流程

开始循环 -> 初始化指针 -> 判断指针是否为空 -> 如果为空，结束

​									      -> 如果不为空 -> 给值变量赋值 -> 给键变量赋值 -> 指针下移 -> 循环体 -> 判断指针是否为空  

#### 引用传递

foreach 值支持引用传递，键不支持引用传递。

foreach遍历的是数组的拷贝。

#### 数组指针的操作

`key()`：从关联数据中取得键名；

`current()`：返回数组中的当前单元；

`next()`：将数组中的内部指针向前移动一位。

`prev()`：将数组中的内部指针到回一位。

`reset()`：将数组的内部指针指向第一个单元。

`end()` ：将数组的内部指针指向最后一个单元。

`each()`：返回数组中的当前键/值对并将数组指针向前移动一步，如果内部指针穿越了数组的末尾，返回false。



如果一个数组连续输出两次，必须要将指针复位。

### 替代语法

PHP提供了替代语法，主要用于在PHP代码和HTML代码混编的时候使用，具有替换语法的语句有if、switch、for、while、foreach，将左大括号变冒号，有大括号变endxxx。	

### 包含文件

在网站中有相同的banner，版权等等页面，我们可以将相同的页面做成包含文件，在展示的页面中包含即可。 

包含文件相当于将文件的内容复制到页面中，如果包含文件有页面结构（HTML），包含后页面中就不止一个页面结构了。这与W3C定义的规范不符合，所以在包含文件中不能出现页面的结构。

#### 语法

1. `include()`：文件可以包含多次，遇到错误报错继续运行；
2. `require()`：文件可以包含多次，遇到错误停止运行；

3. `include_once()`：文件只能包含一次，遇到错误报错继续运行；
4. `require_once()`：文件只能包含一次，遇到错误停止运行；

包含文件相当于拷贝包含文件的代码复制到主文件中，魔术常量除外，魔术常量取的是魔术常量所在文件的信息。

#### include_path

1. `./目录/文件`和`/目录/文件`效果相同，但是后者还受到include_path配置的影响。
2. 可以通过`set_include_path()`来设置包含文件所在的目录。`get_include_path()`：获取。

##### 设置include_path的作用

1. 将项目经常使用的文件放到一个统一的目录下，然后设置通过include_path指向此文件夹，就不用写很长的地址字符串。
2. 将安全性高的文件放到站点外，通过include_path指向此目录，不如连接数据库文件。

### 终止脚本执行

#### exit()和die()

exit是die的别名，终止脚本执行，终止后可以输出一个字符串。

### 延时脚本执行

sleep()

### list

list()：把索引数组中的值赋给一些变量。

###小知识点

1. PHP中可以设置break/continue中断几层循环：`break 2;`

## PHP技巧

###判断变量是否为空

在处理一个没有定义的变量的时候会报错，所以在处理变量之前，我们先要判断一下变量，判断的函数常用如下两个：

1. `isset()`：判断变量是否设置，并且设置的值不为null；
2. `empty()`：判断变量是否为空，只要能转换成bool为false的值，通过empty()检测都为true。

### PHP乱码解决

1. 通过`<meta>`解决

   ```
   <?php
       echo '<meta chatset="utf-8">';
   ```

2. 通过header()解决

   ```
   <?php 
   	header('content-type:text/html;charset=utf-8');
   ```

#### 常用函数

#####操作数组的函数

1. `range(起始值, 结束值)`：生成一个起始值到结束值的数组。

2. `array_merge()`：数组合并。

   如果合并时发生冲突，若键为字符串，元素替换前面的元素；若键为整数，重新建立键索引。

3. `array_rand(数组, 个数)`：随即取出数组内元素，返回随机数组的下标。

4. `shuffle(数组)`：打乱数组，成功返回true，失败返回false。

5. `is_array()`：判断变量是否是数组。

6. `array_search()`：在数组中搜索给定的值，如果成功，返回键，失败返回false。

##### 操作数组键值的函数

1. `array_keys()`：返回数组中的所有键名。
2. `array_values()`：返回数组中的所有值。
3. `array_combine(数组1, 数组2)`：第一个数组做键，第二个数组做值。
4. `in_array(查找的值, 数组)`：检查数组中是否包含某个值。返回bool类型。区分大小写，不区分数据类型。
5. `array_key_exists(键, 数组)`：检查键名或索引是否在数组中。
6. `isset(变量名)`：检测变量是否设置，并且设置的值不为null。

##### 数组连接和字符串分割函数

1. `implode(连接符, 数组)`：别名join()，将数组的值连接成字符串。
2. `explode(连接符, 数组)`：根据连接符将字符串分割成数组。

##### 数组运算函数

1. `array_diff(数组, 数组)`：计算数组的差级并返回。
2. `array_intersect(数组, 数组)`：计算数组的交集并返回，交集使用的是第一个数组的下标。

##### 使用回调函数的函数

回调函数：计算机自己调用的函数，不需要手动调用。

1. `array_map(函数名, 数组1 [,数组2])`：对数组中的每个值进行函数的处理。

   如果传入函数为null，表示默认操作，将两个数组组成多维数组。

2. `array_walk(数组, 函数)`：对数组中的每个元素的键值进行对调处理。

   如果回调函数只有一个参数，那么传值。如果是两个参数，第一个是值，第二个是键。

##### 实现栈和队列效果

1. `array_push(数组, 入栈|队列的值)`：数组中放入元素。
2. `array_pop()`：出栈，将最尾部的元素弹出。
3. `array_shift()`：将队列中的第一个元素移除。
4. `array_unshift()`：向头部插入一个元素。

##### 数组的排序

1. `sort(数组)`：按值进行升序排列，不保持原来的键值关联。如果多位数组排序，默认按数组的第一个值进行排序。
2. `rsort(数组)`：按值进行降序排列，不保持原来的键值关联。
3. `asort(数组)`：按值进行升序排列，保存原来的键值关联。
4. `arsort(数组)`：按值进行降序排列，保存原来的键值关联。
5. `ksort(数组)`：按键进行升序排列。
6. `krsort(数组)`：按键进行降序排序。
7. `natsort(数组)`：自然排序。
8. `usort(数组, 排序函数)`：用户自定义排序。

##### 字符串操作函数

字符串可以理解成字符的集合，所以可以通过[]来访问。不能操作中文。

1. `strlen()`：返回字符串的长度，以字节为单位。
2. `trim()|ltrim()|rtrim()`：去吃字符串两边|左边|右边的空格。
3. `strpos()|strrpos()`：查找字符串从左|右边查找首次出现的位置。
4. `str_repeat(str, 次数)`：将字符串重复多次。
5. `chr()、ord()`：输出一个字符的ASCII码、通过ASCII码获取一个字符。
6. `substr(字符串, 开始位置, 截取长度)`：截取子字符串，若起始位置是负数，表示从结尾向前数。长度如果省略就截取到结尾，长度为负表示后面几个字符不截取。
7. `strchr(str, 字符)|strrchr(str, 字符)`：从左|右开始截取以”字符“开始的子字符串。
8. `str_replace()`：替换字符串。
9. `str_split()`：将字符串分割成数组。
10. `str_pad()`：填充字符串。
11. `strtolower()`：字符串转换成小写。
12. `nl2br()`：将字符串的换行转成`<br>`。
13. `htmlspecialchars()`：将HTML字体转换成实体。
14. `urlencode()|urldecode()`：URL编码和解码。

##### 多字节字符串处理函数

PHP默认本身不支持多字节处理。要开始php_mbstring.dll 扩展（multibytes）

1. `mb_internal_encoding()`：设置/获取内部字符编码。
2. `mb_strlen($str)`

##### 字符串编码

`iconv(输入的字符编码, 输出编码, 字符串)`	

















































